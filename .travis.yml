language: cpp
matrix:
  include:
  - dist: trusty
    compiler: gcc
  - os: osx
    compiler: clang
install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; 
    then 
      sudo apt-get -qq update; 
      sudo apt-get install libwxgtk3.0-dev libwxgtk3.0-0 libgps-dev libglu1-mesa-dev libgtk2.0-dev libbz2-dev libtinyxml-dev; 
      sudo apt-get install libexpat1-dev libcairo2-dev; 
      sudo apt-get install rpm; 
    fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; 
    then 
      brew install cairo libexif xz libarchive;
      wget http://opencpn.navnux.org/build_deps/wx312_opencpn50_macos109.tar.xz; 
      tar xJf wx312_opencpn50_macos109.tar.xz -C /tmp; 
      export PATH="/usr/local/opt/gettext/bin:$PATH";
      echo 'export PATH="/usr/local/opt/gettext/bin:$PATH"' >> ~/.bash_profile; 
      wget http://opencpn.navnux.org/build_deps/Packages.dmg;
      hdiutil attach Packages.dmg; 
      sudo installer -pkg "/Volumes/Packages 1.2.5/Install Packages.pkg" -target "/"; 
    fi
script:
  - if [[ "${COVERITY_SCAN_BRANCH}" == 1 ]]; 
    then 
      echo "Don't build on coverty_scan branch."; 
      exit 0; 
    fi
  - mkdir build && cd build
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; 
    then 
      cmake -DCMAKE_BUILD_TYPE=Release ../ && make -sj2 && sudo make package; 
    fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; 
    then 
      cmake -DwxWidgets_CONFIG_EXECUTABLE=/tmp/wx312_opencpn50_macos109/bin/wx-config -DwxWidgets_CONFIG_OPTIONS="--prefix=/tmp/wx312_opencpn50_macos109" -DCMAKE_INSTALL_PREFIX=/tmp/opencpn -DCMAKE_OSX_DEPLOYMENT_TARGET=10.9 .. && make -sj2 && make create-pkg; 
    fi
  - ls -l;
  
notifications:
  email: false
git:
  depth: 10
before_install:
  - if [ "$CXX" = "g++" ]; 
    then 
      export CXX="g++-6" CC="gcc-6";
    fi
  - if [ "${#OAUTH_ACCESS_TOKEN}" != 0 ]; 
    then 
      (echo OAUTH_ACCESS_TOKEN=${OAUTH_ACCESS_TOKEN} > ~/.dropbox_uploader); 
    fi
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-6
    - g++-6
deploy:
#  - provider: script
#    file: "$TRAVIS_BUILD_DIR/build/*.{deb,rpm,dmg,pkg,txz,pkg.tar.xz}"
#    script: if [ -f ~/.dropbox_uploader ] ; then echo "OSX"; if [ "$TRAVIS_OS_NAME"
#      = "osx" ] ; then echo "upload pkg"; bash ../dropbox_uploader.sh upload $TRAVIS_BUILD_DIR/build/*.pkg
#      / ; fi; echo "Linux"; if [ "$TRAVIS_OS_NAME" = "linux" ] ; then echo "upload
#      rpm"; bash ../dropbox_uploader.sh upload $TRAVIS_BUILD_DIR/build/*.rpm /; echo
#      "upload deb"; bash ../dropbox_uploader.sh upload $TRAVIS_BUILD_DIR/build/*.deb
#      /; fi; fi
#    skip_cleanup: true
#    on: # Set Deploy conditions
#      # Deploy only when tag is not specified
#      tags: false
#      # or this branch
#      #branch: master_1.5
#      all_branches: true
#      # and only when API token is set
#      # condition: ""${#OAUTH_ACCESS_TOKEN} != 0 && $BUILD_TYPE = Release
#      condition: "${#OAUTH_ACCESS_TOKEN} != 0"
  - provider: launchpad
    slug: "~jonsgough/opencpn-plugin-draw/+git/ocpn_draw_pi"
    oauth_token:
      secure: BfjlnC7JHlm1zIelgNMo0WlMWIhRDJvQwQ5UEqdWG4i9ezCRFQVLCQ8sz8vY8mGd2fJSK+OLmz4VGa3Lwg5vsinmRTJ+mJrvJxC65mCWUoTXP7nA2yYuZgqcY740IvPX73pJ8asnXtb7HUWLUYU2FiiiiXWP6ILG7pLIKaXDfqwcJtEINUNmoZMfktixru4Ig8KuoStBtHdHS8xqZ1rVqL5Ug8uZXoi3Xf13pqrdrjlTe7LJiiDxCaNuFc8mTRjBbHofJHgbIwjhvrUpRBNlOsKDddg4lWh7Gz/J2yZD0zzCOPDkxORym4wodVHDtk/FFJ/SgrVTaXVonDYogu/nz+qvYS3K32Rr0dIIDj9/+Zyg0BSBNHFsRd13R4oQWZ/6yV43lxtWTiXGYXfOpg1/iKCt1wmLhkNAJ00VvZKPIwHs6SjaSPy/2NTBy+ZU2acd0vRuFs/TBEdcs5bZxt4epYZeGbjMgnN8Vo96mSvoa/myTeDR0dC1bLoJN0sDUBBsMqfcMH0ab2oEUblQckknexgwpyez2RgR1PEfcxCc9BWLudBbvraZQRlx3W9uEMPhyNqDBe3q1BDGoLEzRLhFtU1XhLAxItBHbL2r8seulkKvISRMhopXI1JLgufgzGI1Eo5OGYZwLUT6DP9+2pI5cF2J8VjKboLPO00GxQQjQhQ=
    oauth_token_secret:
      secure: 0SYsEcYGRu/f3R68LQkkcMkHIGmv3JriN4U0C2kwvsgl/jFbRkm+iE+nHf3UrIh8dCgWpcrVWp1Xt7u7hwJS+v2PKgielN6SEcPIL45o6QXZjDqKNXXWM2B8ydUeCZSJkH4e0ZXs67qNn2bj6uXpgRj2C0xelZFXpov4FOhO5nn/YAWogo+qI7WLQbdy/Kqk0Arz05wLqgH5LnxmKFmNRElx8FHhYC1/w1tYQtzxVYJSjZ/U+0PHzXhjCreYhIGoisw2bfAYUMeKpSIH4tbfRruJQ2/7tuWX3a8vc635aZNmhwM2BUdvMTlZCktuoie/mt2pcZD3+NVvrDNQHnFGeWMemqYxlGmUvPanZJOXNL54nRjkfNRlMY4BkSvXHibihAjkjMZeH2JgMIjSNEUoZOrsL9cQCGDef+iZlTtKXxPEt81Gn08FPJeohGspPq6nl3XTj3sIPbOKih0BtBRo7LR9ol0zx5gyQepH5Ef6r4KhdKqdEV04nFQD4Zht36Ia+854b103RCeNX7zWezcgGCebQpBOIsuDAZQgj5RDIG/Y3r4n1+PgoC2Uw0HSf7D9vyFNAJHTiSIAFvqpco+XsYNJINlgM9HIBvVmcx2UeRquxixjEQjmi7/CTuQ7xq75mRbQJ3UTmpVMEbx2H5YZ2s8l8ZQDXpyHOtcIU8ZTtKE=
    skip_cleanup: true
    on: # Set Deploy conditions
      # Deploy only when tag is not specified
      # tags: false
      # or this branch
      #branches:
      #   only:
      #     - master
      #     - master_1.5
      tags: true
      all_branches: true
      condition: "$TRAVIS_OS_NAME = linux"

  - provider: releases
    api_key:
        secure: "DBA400C8Pvswp0Dsb5aok/iZIw33M1GRzxXrER8fGwh7xw3TRl2/SIkoJNftC2fR4elce7Kom45duBRhrRsfeSjBKBvK/0IscUI+QIMH+OaxGIjxE+ahhpmXlUOdnKc9nkYS5RpPyOPHGU9nzd8A7aA86/KS2qoQmJ1Kcoewb9NJJAVjDvQYGaSzDXvlbqgvn05PFQ5xH6nFoda1Uz3759LovU6vpF0m7OLBCBSfJfOVyktyiqOpbjIAPLUhXDwBTQpGR3/2DFJ232uNNDfkMfCS6hyGvGnkmW+HQdolHnETcySr2R4p7B7CJdX7JJO+pM0v9e53xY2d/FdXa0JniBo0xDYnx5ND2uOMhK663C1Lwp/d307GuPW+hpjRdLnkLuQlTq7pYkwJlc7QSJY0HUSbRUOMtFpCXFMoyOo4iir8Sg0/BPljfQmcrmXiugmHDBrAk8HbhDgRs18Ptsw+YOXiCTbRTl8uJUOZHXh6d7XvgxrxovxG9+fi5VlchCI1TVHEO1cqJY7IsPhNmCC/Z+UecoF2DLDBB4IqPfPytTCVBBzSFXdGKcCdW103jcSx5awHTSkGvOm6aCQOyA/6cmiBSbOpnQ4rgpy6YcQg/gOpMvpPYqanDJCBAIZwc5Z1C1ybGanB5bhqyZmUyS317nvGBVes4PwXR4gHzAH+gKM="
    file_glob: true
    file: "$TRAVIS_BUILD_DIR/build/*.{deb,rpm,dmg,txz,pkg,pkg.tar.xz}"
    skip_cleanup: true
    on:
      tags: true
      all_branches: true


#environment:
#  OAUTH_ACCESS_TOKEN:
#    secure: OIqJeLohefVWvPklh+LxxIZdzVCXU4T++cJqkbaQUiT1HDWvleojgGNARPMG3STP
