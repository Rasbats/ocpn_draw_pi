language: cpp
matrix:
  include:
  - dist: trusty
    compiler: gcc
  - os: osx
    compiler: clang
install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; 
    then 
      sudo apt-get -qq update; 
      sudo apt-get install libwxgtk3.0-dev libwxgtk3.0-0 libgps-dev libglu1-mesa-dev libgtk2.0-dev libbz2-dev libtinyxml-dev; 
      sudo apt-get install libexpat1-dev libcairo2-dev; 
      sudo apt-get install rpm; 
    fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; 
    then 
      brew install cairo libexif xz libarchive;
      wget http://opencpn.navnux.org/build_deps/wx312_opencpn50_macos109.tar.xz; 
      tar xJf wx312_opencpn50_macos109.tar.xz -C /tmp; 
      export PATH="/usr/local/opt/gettext/bin:$PATH";
      echo 'export PATH="/usr/local/opt/gettext/bin:$PATH"' >> ~/.bash_profile; 
      wget http://opencpn.navnux.org/build_deps/Packages.dmg;
      hdiutil attach Packages.dmg; 
      sudo installer -pkg "/Volumes/Packages 1.2.5/Install Packages.pkg" -target "/"; 
    fi
script:
  - if [[ "${COVERITY_SCAN_BRANCH}" == 1 ]]; 
    then 
      echo "Don't build on coverty_scan branch."; 
      exit 0; 
    fi
  - mkdir build && cd build
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; 
    then 
      cmake -DCMAKE_BUILD_TYPE=Release ../ && make -sj2 && sudo make package; 
    fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; 
    then 
      cmake -DwxWidgets_CONFIG_EXECUTABLE=/tmp/wx312_opencpn50_macos109/bin/wx-config -DwxWidgets_CONFIG_OPTIONS="--prefix=/tmp/wx312_opencpn50_macos109" -DCMAKE_INSTALL_PREFIX=/tmp/opencpn -DCMAKE_OSX_DEPLOYMENT_TARGET=10.9 .. && make -sj2 && make create-pkg; 
    fi
  - ls -l;
  
notifications:
  email: false
git:
  depth: 10
before_install:
  - if [ "$CXX" = "g++" ]; 
    then 
      export CXX="g++-6" CC="gcc-6";
    fi
  - if [ "${#OAUTH_ACCESS_TOKEN}" != 0 ]; 
    then 
      (echo OAUTH_ACCESS_TOKEN=${OAUTH_ACCESS_TOKEN} > ~/.dropbox_uploader); 
    fi
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-6
    - g++-6
deploy:
#  - provider: script
#    file: "$TRAVIS_BUILD_DIR/build/*.{deb,rpm,dmg,pkg,txz,pkg.tar.xz}"
#    script: if [ -f ~/.dropbox_uploader ] ; then echo "OSX"; if [ "$TRAVIS_OS_NAME"
#      = "osx" ] ; then echo "upload pkg"; bash ../dropbox_uploader.sh upload $TRAVIS_BUILD_DIR/build/*.pkg
#      / ; fi; echo "Linux"; if [ "$TRAVIS_OS_NAME" = "linux" ] ; then echo "upload
#      rpm"; bash ../dropbox_uploader.sh upload $TRAVIS_BUILD_DIR/build/*.rpm /; echo
#      "upload deb"; bash ../dropbox_uploader.sh upload $TRAVIS_BUILD_DIR/build/*.deb
#      /; fi; fi
#    skip_cleanup: true
#    on: # Set Deploy conditions
#      # Deploy only when tag is not specified
#      tags: false
#      # or this branch
#      #branch: master_1.5
#      all_branches: true
#      # and only when API token is set
#      # condition: ""${#OAUTH_ACCESS_TOKEN} != 0 && $BUILD_TYPE = Release
#      condition: "${#OAUTH_ACCESS_TOKEN} != 0"
  - provider: launchpad
    slug: "~jonsgough/opencpn-plugin-draw/+git/ocpn_draw_pi"
    oauth_token:
      secure: "NPJFPBgLjd24ehODdgmnEyebHjAA/ZtXoo8WyeC3eJ1FfQbDYhaThxGKXG7c6MA4YinrT/wxpVyXj0z4ThQpwHEC3OGdCNYX+uud7qXrEYYrTwJU3NB33KK0DC+BlNsCda+jTegxaXyjvX0cy4r2RpIDnrVSXtKA39BZp2pdczPY4gm9dxze802RhJ0C+Wpy9W5WdYqXLrH4yEAu8LOb4/0EghtjWSj3z4e4lsswZp0B7E9TsdGDfq+UDXKJUHB6n7URuQaDYfI3nE2nfgDnD321MMuPdLIDjWgJTG3JNwgSZsLE2BaePcySECHC1YrNZS541IQ96dFTLkq+bOVjLBmPhZlMqs6FsnmPQ6RIQQGfP2Jg1B87Pq/PhemZW+KT0wV6r0UrekN35HYn68+yyqtiUvD6qmj7gVl928jHrFOesdWEfHCX54duXGCq5oM50k15aP9CODOCjYAKE1UgFDYZ8HMOg/zZS4E30thCisqZU1toRfJhnFBppdzQdvu7iLceCoKXFIPl+i5exKGudX0ZapTPdeISiaGIjUwAIm9rPFwjvIzf/c5nViHH7UAiTAKMHNgXh9dcV2BvNtRPRacVI5uJiTep/c3CrhgJ7pvPPlyILUpMD5NSHqGnlx6O3HwMBfpbcJK8MfTsESQ0vExqOd9BUI6u/t00R+0NWUU="
    oauth_token_secret:
      secure: "kjvZFlPGR+maD2VZ5HlH8EGATA4DQv5A8afvKqQFwx2rSboPx4HsCmaRaUJ5+VmB+GynJ3h+QZgmC8htZu/L0gPokKHszTFy5JRDDMADcFKnzgWG/8PrbT79qOqD1KWhzWxAjX7ZfDmll4zgkM+npdMuUhMjYRXDLiEnuBhisZOpRTDV7J3gem0c6If40EL892HIyvSLUlp1GBH9b+M1uUaYYnohIShuEJ0trAJ8at3LrkGBoaNLxuQNTaPIKaYxXGKnedd4uZsGlAAU93sN4dCd46O3IklvMHo5q0wMWzgMwzpc67yeA2De44koI376UdwGtw+9mllJ+sjcJXaTF/DBzbTgtF46J4RyesjR7kifaLJE1jA2HMXGZ/oRLWQPx0eICPpaKHR/3nS+C2+H1qaPlE6Nuj7krOiW3OfpUwX6pXUW6ukAwY41kQNeq9vIUYjxiAfsA1Bl/TZERzjYeR1wHfhP5jYnFg8lrxLNwNMNg/E+KMZ3dV64FmJ0kkqb0zKwGoer6gkXrwkm0ZVMqxh7B+oppu/CqeBqytMjdHq0kYts0Ds2IU6AJoxFo0XHt/N0Eu48wo/7WNFBkwFhUZcMY+qtRNZZ1pvEM28y8atsKS+NCB50rjOeqB31WkBLneIcMMB9iPk22GMJtFGN3zPVIoe5+/xGkdJwd20opIE="
    skip_cleanup: true
    on: # Set Deploy conditions
      # Deploy only when tag is not specified
      # tags: false
      # or this branch
      #branches:
      #   only:
      #     - master
      #     - master_1.5
      tags: true
      all_branches: true
      condition: "$TRAVIS_OS_NAME = linux"

  - provider: releases
    api_key:
        secure: "DBA400C8Pvswp0Dsb5aok/iZIw33M1GRzxXrER8fGwh7xw3TRl2/SIkoJNftC2fR4elce7Kom45duBRhrRsfeSjBKBvK/0IscUI+QIMH+OaxGIjxE+ahhpmXlUOdnKc9nkYS5RpPyOPHGU9nzd8A7aA86/KS2qoQmJ1Kcoewb9NJJAVjDvQYGaSzDXvlbqgvn05PFQ5xH6nFoda1Uz3759LovU6vpF0m7OLBCBSfJfOVyktyiqOpbjIAPLUhXDwBTQpGR3/2DFJ232uNNDfkMfCS6hyGvGnkmW+HQdolHnETcySr2R4p7B7CJdX7JJO+pM0v9e53xY2d/FdXa0JniBo0xDYnx5ND2uOMhK663C1Lwp/d307GuPW+hpjRdLnkLuQlTq7pYkwJlc7QSJY0HUSbRUOMtFpCXFMoyOo4iir8Sg0/BPljfQmcrmXiugmHDBrAk8HbhDgRs18Ptsw+YOXiCTbRTl8uJUOZHXh6d7XvgxrxovxG9+fi5VlchCI1TVHEO1cqJY7IsPhNmCC/Z+UecoF2DLDBB4IqPfPytTCVBBzSFXdGKcCdW103jcSx5awHTSkGvOm6aCQOyA/6cmiBSbOpnQ4rgpy6YcQg/gOpMvpPYqanDJCBAIZwc5Z1C1ybGanB5bhqyZmUyS317nvGBVes4PwXR4gHzAH+gKM="
    file_glob: true
    file: "$TRAVIS_BUILD_DIR/build/*.{deb,rpm,dmg,txz,pkg,pkg.tar.xz}"
    skip_cleanup: true
    on:
      tags: true
      all_branches: true


#environment:
#  OAUTH_ACCESS_TOKEN:
#    secure: OIqJeLohefVWvPklh+LxxIZdzVCXU4T++cJqkbaQUiT1HDWvleojgGNARPMG3STP
